trigger:
  branches:
    include:
      - main  # Change this to your desired branch

pool:
  name: 'tzl-wl'

steps:
- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      TOKEN=$(cat /run/secrets/kubernetes.io/serviceaccount/token) 
      
      curl_command="curl -H \"Authorization: Bearer $TOKEN\" --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt https://kubernetes/api/v1/"
      
      echo "$curl_command"
      
      /usr/local/bin/kubectl get pods
 
#- task: Kubernetes@1
#  inputs:
#    connectionType: 'Kubernetes Service Connection'
#    kubernetesServiceEndpoint: 'tzlpoc-svc'
#    namespace: 'default'
#    command: 'get'
#    useConfigurationFile: true
#    configuration: '/usr/local/bin/kubectl'
#    arguments: 'pods'
#    secretType: 'dockerRegistry'
#    containerRegistryType: 'Container Registry'
#    versionSpec: '1.27.3'
#    outputFormat: 'none'
  
#    secretType: 'dockerRegistry'
#    containerRegistryType: 'Azure Container Registry'
#    secretType: 'dockerRegistry'
#    containerRegistryType: 'Azure Container Registry'
#- task: Docker@2
#  displayName: 'Build and push Docker image'
#  inputs:
#    command: 'buildAndPush'
#    containerRegistry: 'dockerafk'  # Use the service connection name you created earlier
#    repository: 'alperanfk/cicd'  # Replace with your Docker Hub username and image repository name
#    Dockerfile: '**/Dockerfile'  # Path to your Dockerfile
